<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>商品详情页</title>
		<link rel="stylesheet" href="/layui/css/layui.css">
		<script src="/layui/layui.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script src="/layui/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body class="layui-layout-body">
		<div class="layui-layout layui-layout-admin">
			<div class="layui-bg-green layui-header layui-row">
				<div class="layui-logo">
					<a style="color: white;" href="/index.html">人生艰难书店</a>
				</div>
				<div class="layui-col-xs-offset4 layui-col-xs4 layui-row"
					style="margin-top: 11px;">
					<div class="layui-col-xs10">
						<input type="text" id="commodityName" placeholder="请输入商品名称"
							class="layui-input">
					</div>
					<button type="button" onclick="search()" class="layui-btn">
						<i class="layui-icon layui-icon-search layui-col-xs2"></i>
					</button>
				</div>
				<ul class="layui-nav layui-col-xs-offset9" id="nav">
					<li v-if="isLogin == false" class="layui-nav-item"><a
						href="/login.html">请登录</a></li>
					<li v-else class="layui-nav-item"><a href="javascript:;">欢迎您，{{nickname}}</a>
						<dl class="layui-nav-child">
							<dd>
								<a href="/self.html">我的信息</a>
							</dd>
							<dd>
								<a href="">我的图书</a>
							</dd>
							<dd>
								<a href="">购物车</a>
							</dd>
							<dd>
								<a href="/user/exit">退出</a>
							</dd>
						</dl></li>
					<li class="layui-nav-item"><a href="javascript:;">我的订单</a>
						<dl class="layui-nav-child">
							<dd>
								<a href="">移动模块</a>
							</dd>
							<dd>
								<a href="">后台模版</a>
							</dd>
							<dd>
								<a href="">电商平台</a>
							</dd>
						</dl></li>
					<li class="layui-nav-item"><a href="">留言</a></li>
				</ul>
			</div>
			<div class="layui-body" style="margin-top: 30px;">
				<div class='layui-card layui-col-xs10' style='height: 300px;margin-top: 50px;background-color: #F2F2F2;'>
					<div class='layui-col-xs4'>
						<img id="image" th:src="@{'http://192.168.0.104:8054/bookstore/commodity/'+${commodity.imageName}+'.jpg'}" style="width: 250px;height: 250px;margin: 25px;">
					</div>
					<div class='layui-col-xs8'>
						<div style='height: 80px;margin-top: 20px;'>
							<a style="font-size: 40px;"><b th:text="${commodity.name}"></b></a>
						</div>
						<div style='height: 90px;'>
							<span th:text="${commodity.content}"></span>
						</div>
						<div style='height: 30px;font-size: 18px'>
							<b>作者：</b><b th:text="${commodity.author}"></b>
						</div>
						<div style='height: 30px;color: red;'>
							<b>￥</b><b th:text="${commodity.price}"></b>
						</div>
						<button type="button" class="layui-btn" onclick="addShop()">加入购物车</button>
						<button type="button" class="layui-btn layui-bg-red" onclick="buy()">购买</button>
					</div>
				</div>
			</div>
		</div>
		<script>
						
			function addShop(){
				if(vue.isLogin){
					$.getJSON('../shop/addShop?commodityId=[[${commodity.id}]]', function(result){
						layui.use('layer', function(){
							var layer = layui.layer;
							if(result.code == 200){
								layer.msg('加入购物车成功');
							}else if(result.code == 404){
								alert("用户信息失效，请重新登录");
								window.location.href = '../login.html';
							}else {
								layer.msg(result.msg)
							}
						})
					})
				}else{
					alert("请去登录");
					window.location.href = '../login.html';
				}
				
			}
			
			function buy(){
				alert("购买")
			}
			
			/**
			 * 导航栏相关
			 * */
			
			var vue = new Vue({
				el: '#nav',
				data: {
					isLogin: false,
					nickname: '',
					username: ''
				}
			});
			$.getJSON('/user/isLogin', function(result) {
				if (result.code == 200) {
					vue.nickname = result.userInfo.nickname;
					vue.username = result.userInfo.username;
					vue.isLogin = true;
				}
			})
			layui.use(['element', 'laypage', 'layer'], function() {
				var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

			});
			//点击搜索
			function search() {
				var commodityName = $("#commodityName").val();
				window.location.href = "/search.html?commodityName=" + commodityName;
			}

		</script>
	</body>
</html>
