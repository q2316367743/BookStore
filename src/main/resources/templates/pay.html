<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>支付</title>
<link rel="stylesheet" href="/layui/css/layui.css">
<script src="/layui/layui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="/layui/jquery-3.5.1.min.js" type="text/javascript"
	charset="utf-8"></script>
<style type="text/css">
.mbuy {
	positon: abslute;
	right: 20px;
	bottom: 20px;
}
</style>
</head>
<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-bg-green layui-header layui-row">
			<div class="layui-logo">
				<a style="color: white;" href="/index.html">人生艰难书店</a>
			</div>
			<div class="layui-col-xs-offset4 layui-col-xs4 layui-row"
				style="margin-top: 11px;">
				<div class="layui-col-xs10">
					<input type="text" id="commodityName" placeholder="请输入商品名称"
						class="layui-input">
				</div>
				<button type="button" onclick="search()" class="layui-btn">
					<i class="layui-icon layui-icon-search layui-col-xs2"></i>
				</button>
			</div>
			<ul class="layui-nav layui-col-xs-offset9" id="nav">
				<li class="layui-nav-item"><a href="/index.html">主页</a></li>
				<li class="layui-nav-item"><a href="">留言</a></li>
				<li class="layui-nav-item"><a href="javascript:;">欢迎您，[[${user.nickname}]]</a>
					<dl class="layui-nav-child">
							<dd><a href="/user/self#my">我的信息</a></dd>
							<dd><a href="/user/self#record">我的图书</a></dd>
							<dd><a href="/user/self#shop">购物车</a></dd>
							<dd><a href="/user/exit">退出</a></dd>
						</dl>
				</li>
			</ul>
		</div>
		<div class="layui-body" style="margin-top: 20px;">
			<div style="font-size: 25px">
				<b>支付页面</b>
			</div>
			<div class='layui-card layui-col-xs10'
				style='height: 300px; margin-top: 20px; background-color: #F2F2F2;'>
				<div class='layui-col-xs4'>
					<img id="image"
						th:src="@{'http://192.168.0.105/image/bookstore/commodity/'+${commodity.imageName}+'.jpg'}"
						style="width: 250px; height: 250px; margin: 25px;">
				</div>
				<div class='layui-col-xs8'>
					<div style='height: 80px; margin-top: 20px;'>
						<a style="font-size: 40px;"><b th:text="${commodity.name}"></b></a>
					</div>
					<div style='height: 90px;'>
						<span th:text="${commodity.content}"></span>
					</div>
					<div style='height: 30px; font-size: 18px'>
						<b>作者：</b><b th:text="${commodity.author}"></b>
					</div>
				</div>
			</div>
			<div class='layui-card layui-col-xs10 layui-form-pane'
				style='height: 100px; margin-top: 20px; background-color: #F2F2F2;'>
				<div class="layui-col-xs3 layui-col-xs-offset1 "
					style="margin-top: 5px;">
					<div class="layui-form-item">
						<label class="layui-form-label">余额</label> <label
							class="layui-form-label" th:text="${user.balance}"></label>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">价格</label> <label
							class="layui-form-label" th:text="${commodity.price}"></label>
					</div>
				</div>
				<div class="layui-col-xs7">
					<div class="layui-form-item" style="margin-top: 5px;">
						<label class="layui-form-label">买后剩余</label> <label
							class="layui-form-label"
							th:text="${user.balance} - ${commodity.price}"></label>
					</div>
				</div>
				<button id="isBuy" style="margin-top: 50px" type="button"
					class="layui-btn layui-bg-red" onclick="buy()">购买</button>
			</div>
		</div>
	</div>
	<script>
						
			
			
			function buy(){
				$.getJSON('buy', {commodityId: [[${commodity.id}]]},function(result){
					layui.use('layer', function(){
				var layer = layui.layer;
				if(result.code == 200){
					layer.open({
						title: '购买结果',
						content: '购买成功',
						btm: ["确定"],
						yes: function(index, layero) {
							window.location.href = "/index.html";
						}
					})
				}else if(result.code == 400){
					layer.mag(result.msg);
				}else if(result.code == 404){
					layer.open({
						title: '警告',
						content: '未登录，请先登录',
						btm: ["确定"],
						yes: function(index, layero) {
							window.location.href = "/login.html";
						}
					})
				}
					})
				})
			}
			
			if([[${user.balance} - ${commodity.price}]] < 0){
				$("#isBuy").attr({"disabled":"disabled"});
			}
			
			layui.use(['element', 'laypage', 'layer'], function() {
				var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

			});
			//点击搜索
			function search() {
				var commodityName = $("#commodityName").val();
				window.location.href = "/search.html?commodityName=" + commodityName;
			}

		</script>
</body>
</html>
