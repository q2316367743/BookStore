<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>主页</title>
		<link rel="stylesheet" href="layui/css/layui.css">
		<script src="layui/layui.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script src="layui/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			.body {
				margin-top: 20px;
			}

			.item {
				margin-top: 40px;
			}

			.mradio {
				border: 0px;
				width: 50px;
				height: 20px;
				background-color: #333;
				font-size: 12px;
				color: #fff;
			}
		</style>
	</head>
	<body class="layui-layout-body">
		<div class="layui-layout layui-layout-admin" id="nav">
			<div class="layui-bg-green layui-header layui-row">
				<div class="layui-logo"><a style="color: white;" href="/index.html">人生艰难书店</a></div>
				<div class="layui-col-xs-offset3 layui-col-xs4 layui-row" style="margin-top: 11px;">
					<div class="layui-col-xs10">
						<input type="text" id="commodityName" placeholder="请输入商品名称" class="layui-input">
					</div>
					<button type="button" onclick="search()" class="layui-btn"><i class="layui-icon layui-icon-search layui-col-xs2"></i></button>
				</div>
				<ul class="layui-nav layui-col-xs-offset9">
					<li v-if="isLogin == false" class="layui-nav-item"><a href="login.html">请登录</a></li>
					<li v-else class="layui-nav-item">
						<a href="javascript:;">欢迎您，{{nickname}}</a>
						<dl class="layui-nav-child">
							<dd><a v-bind:href="'self.html?username=' + username">我的信息</a></dd>
							<dd><a href="">我的图书</a></dd>
							<dd><a href="">购物车</a></dd>
							<dd><a href="user/exit">退出</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item">
						<a href="javascript:;">我的订单</a>
						<dl class="layui-nav-child">
							<dd><a href="">移动模块</a></dd>
							<dd><a href="">后台模版</a></dd>
							<dd><a href="">电商平台</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item"><a href="">留言</a></li>
				</ul>
			</div>
			<div style="font-size: 20px" class="layui-col-xs-offset3 layui-col-xs6">

				<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
					<ul class="layui-tab-title">
						<li class="layui-this">个人信息</li>
						<li class="layui-col-xs-offset1">购物车</li>
						<li class="layui-col-xs-offset1">购买记录</li>
					</ul>
					<div class="layui-tab-content" style="height: 100px;">
						<div class="layui-tab-item layui-show">
							<div class="layui-col-xs10 layui-col-xs-offset1">
								<div class="item">
									<label class="layui-form-label">昵称：</label>
									<div class="layui-input-block"><input id="nickname" class="layui-input" type="text" v-model="nickname" /></div>
								</div>
								<div class="item">
									<label class="layui-form-label">账户：</label>
									<div class="layui-input-block"><input disabled="disabled" id="username" class="layui-input" type="text"
										 v-bind:value="username" /></div>
								</div>
								<div class="item">
									<label class="layui-form-label">性别：</label>
									<div class="layui-input-block">
										<input type="radio" class="mradio" v-model="gender" name="gender" value="1" id="man"><label for="man">男</label>
										<input type="radio" class="mradio" v-model="gender" name="gender" value="0" id="woman"><label for="woman">女</label>
									</div>
								</div>
								<div class="item">
									<label class="layui-form-label">年龄：</label>
									<div class="layui-input-block"><input id="age" class="layui-input" type="text" v-model="age" /></div>
								</div>
								<div class="item">
									<label class="layui-form-label">操作：</label>
									<div class="layui-input-block"><button type="button" class="layui-btn layui-btn-radius layui-btn-warm" onclick="update()">修改</button>&nbsp;&nbsp;
										<button type="button" class="layui-btn layui-btn-radius layui-btn-danger" onclick="removeUser()">注销</button></div>
								</div>
							</div>
						</div>
						<div class="layui-tab-item">
							<div class='layui-card' style='height: 170px;padding: 10px;background-color: #F2F2F2;' v-for="commodity in commoditys">
								<div class='layui-col-xs4'>
									<img v-bind:src="'http://192.168.0.104:8054/bookstore/commodity/' + commodity.imageName + '.jpg'">
								</div>
								<div class='layui-col-xs4'>
									<div style='height: 40px;margin-top: 20px;'>
										<a href=''>{{commodity.name}}</a>
									</div>
									<div style='height: 50px;color: red;'>
										<b>￥{{commodity.price}}</b>
									</div>
									<button type="button" class="layui-btn layui-bg-red" onclick="window.location.href = 'index.html'">购买</button>
								</div>
							</div>
							<div v-if="commoditys.length == 0">
								购物车没有记录
							</div>
						</div>
						<div class="layui-tab-item">
							<div class='layui-card' style='height: 170px;padding: 10px;background-color: #F2F2F2;' v-for="record in records">
								<div class='layui-col-xs4'>
									<img v-bind:src="'http://192.168.0.104:8054/bookstore/commodity/' + record.imageName + '.jpg'">
								</div>
								<div class='layui-col-xs4'>
									<div style='height: 40px;margin-top: 20px;'>
										<a href=''>{{record.name}}</a>
									</div>
									<div style='height: 50px;color: red;'>
										<b>￥{{record.price}}</b>
									</div>
									<button type="button" class="layui-btn layui-bg-red" onclick="window.location.href = 'index.html'">阅读</button>
									<button type="button" class="layui-btn" onclick="window.location.href = 'index.html'">下载</button>
								</div>
							</div>
							<div v-if="records.length == 0">
								没有购买记录
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<script>
			function search() {
				var commodityName = $("#commodityName").val();
				window.location.href = "search.html?commodityName=" + commodityName;
			}

			function update() {
				console.log("username:" + vue.username + ",nickname:" + vue.nickname + ",gender:" +
					vue.gender + ",age:" + vue.age);
				$.post('user/update', {
					username: vue.username,
					nickname: vue.nickname,
					gender: vue.gender,
					age: vue.age
				}, function(result) {
					layui.use('layer', function() {
						var layer = layui.layer;
						layer.open({
							title: '修改结果',
							content: result.code == 200 ? '修改成功' : '修改失败，原因：' + result.message,
							btm: ["确定"],
							yes: function(index, layero) {
								location.reload()
							}
						})
					});
				})
			}

			function removeUser() {
				layui.use('layer', function() {
					var layer = layui.layer;
					layer.confirm('真的要注销吗', {
						btn: ['想好了，注销', '我再想想'] //可以无限个按钮
							,
						btn2: function(index, layero) {
							console.log("我再想想")
						}
					}, function(index, layero) {
						console.log("想好了，注销")
					});
				});
			}
			window.onload = function() {
				layui.use(['form', 'element'], function() {
					var element = layui.element;
					var form = layui.form;
				})
				vue = new Vue({
					el: '#nav',
					data: {
						isLogin: false,
						nickname: '',
						username: '',
						gender: '0',
						age: '',
						commoditys: [],
						records: []
					},
					created: function() {
						//获取用户信息
						$.getJSON('user/getInfo', function(result) {
							if (result.code == 200) {
								vue.nickname = result.userInfo.nickname;
								vue.username = result.userInfo.username;
								vue.gender = result.userInfo.gender ? 1 : 0;
								vue.age = result.userInfo.age;
								vue.isLogin = true;
								//获取购物车信息
								//获取购买记录信息
							} else if (result.code == 400) {
								alert("请先登录," + result.message);
								window.location.href = "login.html"
							}
						})
					}
				});
			}
		</script>
	</body>
</html>
